\documentclass[12pt]{article}
\usepackage{multirow}
\usepackage{tabls}
\usepackage{afterpage}
\usepackage{cites}
\usepackage{booktabs}
\usepackage{epsf}
\usepackage{amsmath}   
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{bm}
\usepackage{epsfig}
\usepackage{rotating}
\usepackage{setspace}
\usepackage{tabls}
\usepackage{hhline}
\usepackage{float}
\usepackage{subfigure}
%\usepackage{subfigmat}
%\usepackage{cites}
% uncomment for submission of manuscript to NSE
\usepackage[nolists, nomarkers]{endfloat}
%
% use to include postscript figures
\usepackage{graphicx}
%
%\usepackage[light,firsttwo]{draftcopy}
%\draftcopySetGrey{0.90}
                                                                                                            
%\usepackage{dbl}
% -----------------------------------------------------------------------------
% define newcommands
% -----------------------------------------------------------------------------

%\setlength{\floatsep}{4pt plus 1pt minus 1pt}
\setlength{\textfloatsep}{8pt plus 1pt minus 1pt}
%\setlength{\intextsep}{4pt plus 1pt minus 1pt}
\setlength{\abovedisplayskip}{4pt plus 1pt minus 1pt}
\setlength{\belowdisplayskip}{4pt plus 1pt minus 1pt}

%\makeatletter
%\renewcommand{\@thesubfigure}{\thefigure\thesubfigure\space}
%\makeatother
% =================================================================================================
% more new commands
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

\addtolength{\oddsidemargin}{-0.5in}
\addtolength{\textwidth}{1.0in}
\addtolength{\textheight}{0.5in}
\renewcommand{\thefootnote}{\fnsymbol{footnote}}
%
% -----------------------------------------------------------------------------
% define newcommands
% -----------------------------------------------------------------------------

%\setlength{\floatsep}{4pt plus 1pt minus 1pt}
\setlength{\textfloatsep}{8pt plus 1pt minus 1pt}
%\setlength{\intextsep}{4pt plus 1pt minus 1pt}
\setlength{\abovedisplayskip}{4pt plus 1pt minus 1pt}
\setlength{\belowdisplayskip}{4pt plus 1pt minus 1pt}

% =================================================================================================
% more new commands
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

% Ways of grouping things
%
\newcommand{\bracket}[1]{\left[ #1 \right]}
\newcommand{\bracet}[1]{\left\{ #1 \right\}}
\newcommand{\fn}[1]{\left( #1 \right)}
\newcommand{\ave}[1]{\left\langle #1 \right\rangle}
%
% Derivative forms
%
\newcommand{\dx}[1]{\,d#1}
\newcommand{\dxdy}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\dxdt}[1]{\frac{\partial #1}{\partial t}}
\newcommand{\dxdz}[1]{\frac{\partial #1}{\partial z}}
\newcommand{\dfdt}[1]{\frac{\partial}{\partial t} \fn{#1}}
\newcommand{\dfdz}[1]{\frac{\partial}{\partial z} \fn{#1}}
\newcommand{\ddt}[1]{\frac{\partial}{\partial t} #1}
\newcommand{\ddz}[1]{\frac{\partial}{\partial z} #1}
\newcommand{\dd}[2]{\frac{\partial}{\partial #1} #2}
\newcommand{\ddx}[1]{\frac{\partial}{\partial x} #1}
\newcommand{\dddx}[1]{\frac{d #1}{d x}}
\newcommand{\ddy}[1]{\frac{\partial}{\partial y} #1}
%
% Vector forms
%
%\renewcommand{\vec}[1]{\ensuremath{\stackrel{\rightarrow}{#1}}}
%\renewcommand{\div}{\ensuremath{\vec{\nabla} \cdot}}
%\newcommand{\grad}{\ensuremath{\vec{\nabla}}}
\renewcommand{\vec}[1]{\overrightarrow{#1}}
\renewcommand{\div}{\vec{\nabla}\! \cdot \!}
\newcommand{\grad}{\vec{\nabla}}
\newcommand{\oa}[1]{\fn{\frac{1}{3}\hat{\Omega}\!\cdot\!\overrightarrow{A_{#1}}}}

%
% Equation beginnings and endings
%
\newcommand{\bea}{\begin{eqnarray}}
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\beas}{\begin{eqnarray*}}
\newcommand{\eeas}{\end{eqnarray*}}
\newcommand{\bdm}{\begin{displaymath}}
\newcommand{\edm}{\end{displaymath}}
%
% Equation punctuation
%
\newcommand{\pec}{\hspace{0.25in},}
\newcommand{\pep}{\hspace{0.25in}.}
\newcommand{\pev}{\hspace{0.25in}}
%
% Equation labels and references, figure references, table references
%
\newcommand{\LEQ}[1]{\label{eq:#1}}
\newcommand{\EQ}[1]{Eq.~(\ref{eq:#1})}
\newcommand{\EQS}[1]{Eqs.~(\ref{eq:#1})}
\newcommand{\REQ}[1]{\ref{eq:#1}}
\newcommand{\LFI}[1]{\label{fi:#1}}
\newcommand{\FI}[1]{Fig.~\ref{fi:#1}}
\newcommand{\RFI}[1]{\ref{fi:#1}}
\newcommand{\LTA}[1]{\label{ta:#1}}
\newcommand{\TA}[1]{Table~\ref{ta:#1}}
\newcommand{\RTA}[1]{\ref{ta:#1}}

%
% List beginnings and endings
%
\newcommand{\bl}{\bss\begin{itemize}}
\newcommand{\el}{\vspace{-.5\baselineskip}\end{itemize}\ess}
\newcommand{\ben}{\bss\begin{enumerate}}
\newcommand{\een}{\vspace{-.5\baselineskip}\end{enumerate}\ess}
%
% Figure and table beginnings and endings
%
\newcommand{\bfg}{\begin{figure}}
\newcommand{\efg}{\end{figure}}
\newcommand{\bt}{\begin{table}}
\newcommand{\et}{\end{table}}
%
% Tabular and center beginnings and endings
%
\newcommand{\bc}{\begin{center}}
\newcommand{\ec}{\end{center}}
\newcommand{\btb}{\begin{center}\begin{tabular}}
\newcommand{\etb}{\end{tabular}\end{center}}
%
% Single space command
%
%\newcommand{\bss}{\begin{singlespace}}
%\newcommand{\ess}{\end{singlespace}}
\newcommand{\bss}{\singlespacing}
\newcommand{\ess}{\doublespacing}
%
%---New environment "arbspace". (modeled after singlespace environment
%                                in Doublespace.sty)
%   The baselinestretch only takes effect at a size change, so do one.
%
\def\arbspace#1{\def\baselinestretch{#1}\@normalsize}
\def\endarbspace{}
\newcommand{\bas}{\begin{arbspace}}
\newcommand{\eas}{\end{arbspace}}
%
% An explanation for a function
%
\newcommand{\explain}[1]{\mbox{\hspace{2em} #1}}
%
% Quick commands for symbols
%
\newcommand{\half}{\frac{1}{2}}
\newcommand{\third}{\frac{1}{3}}
\newcommand{\twothird}{\frac{2}{3}}
\newcommand{\fourth}{\frac{1}{4}}
\newcommand{\mdot}{\dot{m}}
\newcommand{\ten}[1]{\times 10^{#1}\,}
\newcommand{\cL}{{\cal L}}
\newcommand{\cD}{{\cal D}}
\newcommand{\cF}{{\cal F}}
\newcommand{\cE}{{\cal E}}
\newcommand{\mS}{\mathbf{S}}
\newcommand{\mD}{\mathbf{D}}
\newcommand{\mM}{\mathbf{M}}
\newcommand{\mX}{\mathbf{X}}
\newcommand{\mI}{\mathbf{I}}
\newcommand{\mB}{\mathbf{B}}
\renewcommand{\Re}{\mbox{Re}}
\newcommand{\Ma}{\mbox{Ma}}
%
% Inclusion of Graphics Data
%
%\input{psfig}
%\psfiginit
%
% More Quick Commands
%
\newcommand{\bi}{\begin{itemize}}
\newcommand{\ei}{\end{itemize}}
\newcommand{\dxi}{\Delta x_i}
\newcommand{\dyj}{\Delta y_j}
\newcommand{\ts}[1]{\textstyle #1}
% =================================================================================================
\date{}

\begin{document}

%\bibliographystyle{nse}
%\bibnum{p}

\thispagestyle{empty}

\ess
\begin{center}
\textbf{\large \\%
Comparison of Two Galerkin Quadrature Methods
}
% 
% FIRST AUTHORS 
%
\\
\setlength{\baselineskip}{14pt}
\vspace{12pt}
\textbf{Jim E. Morel}\\
%\footnote{Footnote, if necessary, in Times New Roman font and font size 9} \\
Department of Nuclear Engineering\\
%TAMU 3133 \\
Texas A\&M University\\
College Station, TX  77843-3133\\


% 
% SECOND AUTHORS (if not needed delete from here) 
%
\vspace{12pt}
\textbf{James S. Warsa}\\
Los Alamos National Laboratory\\
Los Alamos, NM 87545\\
 
%
% SECOND AUTHORS (to here)
%
\vspace{12pt}
\textbf{Brian C. Franke}\\
Sandia National Laboratories\\
Albuquerque, NM 87185\\


%
% SECOND AUTHORS (to here)
%
\vspace{12pt}
\textbf{Anil K. Prinja}\\
Department of Chemical and Nuclear Engineering\\
University of New Mexico\\
Albuquerque, NM 87131\\
$ $\\

\emph{ morel@tamu.edu, warsa@lanl.gov, bcfrank@sandia.gov, prinja@unm.edu}\\


\vspace{2.0in}

Send proofs and page charges to:\\
\vspace{0.1in}
Professor Jim E. Morel\\
Texas A\&M University\\
Department of Nuclear Engineering\\
TAMU 3133\\
College Station, TX  77843-3133\\
\vspace{0.25in}
36 Pages -- 1 Tables -- 13 Figures \\
\ec
\ess

% =================================================================================================

\newpage

%\setcounter{page}{1}


\begin{abstract} 

We compare two methods for generating Galerkin quadratures. In Method 1, the standard S$_n$ method is 
used to generate the moment-to-discrete matrix and the discrete-to-moment matrix is generated by inverting 
the moment-to-discrete matrix. This is a particular form of the original Galerkin quadrature method. In Method 2, 
which we introduce here, the standard S$_n$ method is used to generate the discrete-to-moment matrix and the 
moment-to-discrete matrix is generated by inverting the discrete-to-moment matrix.  Method 1 has the advantage that it 
preserves in a pointwise sense both $N$ eigenvalues and $N$ eigenvectors of the scattering operator 
with an $N$-point quadrature. Method 2 has the advantage that it generates consistent angular moment 
equations from the corresponding S$_N$ equations while preserving $N$ eigenvalues of the scattering operator 
with an $N$-point quadrature. Our computational results indicate that these two methods are quite comparable 
for the test problem considered.
  
\end{abstract}

\newpage

% =============================================================================
% Introduction
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

\section{Introduction}
\label{sec:intro}
The Galerkin quadrature (GQ) method was introduced by Morel in 1990  \cite{Morel89} to better treat highly anisotropic scattering 
in S$_n$ calculations.  Every Galerkin quadrature set is completely defined by an invertible linear mapping between the discrete 
S$_n$ angular fluxes and a set of spherical-harmonic flux moments.  The matrix that maps the fluxes to the moments is called the 
discrete-to-moment matrix and the matrix that maps the moments to the fluxes is called the moment-to-discrete matrix.  These matrices 
are inverses of each other, and they are used together with a diagonal matrix of Legendre cross section moments to construct the S$_n$ 
scattering source.  Distinct versions of the GQ method vary only with repect to how the invertible mapping is constructed.  One can 
cast the standard S$_n$ scattering source in terms of discrete-to-moment, moment-to-discrete, and cross section moment matrices, but 
one finds that the discrete-to-moment and moment-to-discrete matrices are generally not inverses of each other.  This can be remedied 
by accepting either the standard S$_n$ discrete-to-moment matrix and inverting it to obtain the moment-to-discrete matrix or by accepting 
the standard S$_n$ moment-to-discrete matrix and inverting it to obtain the discrete-to-moment matrix.  We refer to the former as Method~1 
and to the latter as Method~2.  We of course assume that the matrices will be invertible and well conditioned, but this is not necessarily so. 
In 1-D slabs and spheres, the choice of spherical-harmonics (Legendre polynomials) is trivial.  With an 
$N$-point quadrature set, one maps to Legendre moments $0$ through $N-1$.  In multidimensions, the choice is not necessarily clear since the 
number of directions in a standard quadrature set is not equal the number of spherical harmonics of any given order.  Nonetheless, 
prescriptions have been successfully made for triangular and product sets in various geometries \cite{Morel89, Richard, Trahan}.

Method~1 was introduced in the original GQ paper \cite{Morel89}. Method~2 is being introduced here, but the 
invertible mapping obtained by using a standard quadrature formula to map the discrete angular fluxes to the flux moments was recently used in 
two references. The first related to a 1-D Cartesian/spherical discretization for the Fokker-Planck operator \cite{warsa}, and the second related 
to the demonstration of an equivalence between the 1-D slab-geometry S$_N$ equations with arbitrary quadrature and the P$_{N-1}$ equations with 
a quadrature-dependent closure \cite{Morel12}. 

The purpose of the work described herein is to computationally compare Methods~1 and 2 for calculations with highly anisotropic   
scattering in 2-D Cartesian geometry.  In particular we apply these methods to a problem with highly forward-peaked scattering that 
strongly approximates Fokker-Planck scattering.  Fokker-Planck scattering represents a limit in which the scattering mean-free-path 
approaches zero while the mean cosine of the scattering angle approaches unity in such a way that the transport-corrected scattering 
cross section remains constant \cite{FP}.  As such, it represents a severe test for schemes intended to treat anisotropic scattering.  

Our computational results indicate that these two methods are very comparable for test problem considered.  While the discrete-to-moment and moment-to-discrete matrices for each set differ significantly for sufficiently high order moments, the higher order moments in the problem we considered 
tend to be small, leading to similar angular flux solutions.  Relatively small higher-order moments are expected because, as we later show, 
the Fokker-Planck operator preferentially attenuates higher-order moments.  

This paper is organized as follows.  First we describe Method~1.  Then we describe Method~2.  Our test problems are next described and computational results are given.  Finally, we give conclusions and recommendations for future work.



% =============================================================================
% Finite-Element Methods
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

\section{Method~1}
Method~1 is most easily illustrated in terms of 1-D quadrature.  Consider a set of $N$ discrete cosines:$\{\mu_m\}_{m=1}^{N}$, and an associated set 
of interpolatory basis functions, $\{B_m(\mu)\}^{N}_{m=1}$.  These basis functions can span any space in principle, but they must satisfy 
\be
B_i(\mu_j) = \delta_{ij} \pec \quad \mbox{for all $i$ and $j$},
\LEQ{1}
\ee
where $\delta_{ij}$ is the Dirac delta.  This implies that the GQ angular flux solution can be represented as follows:
\be
\tilde{\psi}(\mu) = \sum_{m=1}^{N} \psi_m B_m(\mu) \pec \quad \mbox{for all $m$}.
\LEQ{2}
\ee
where 
\be
\psi_m = \psi(\mu_m) \pep
\LEQ{3}
\ee
Thus the angular flux unknowns associated with the GQ method are standard S$_N$ discrete angular fluxes.  The discrete angular 
flux values are mapped to a set of $N$ Legendre polynomial moments as follows:
\be
\phi_{k} = \frac{1}{2} \int_{-1}^{+1} P_k(\mu) \tilde{\psi}(\mu)  \; d\mu \pec \quad k=0,N-1.
\LEQ{4}
\ee
where P$_k(\mu)$ is the Legendre polynomial of degree $k$.
We can express \EQ{4} in matrix form as follows:
\be
\vec{\phi} = \mD \vec{\psi} \pec
\LEQ{5}
\ee
where 
\be
\vec{\phi} = (\phi_0, \phi_1, \phi_2 , \ldots, \phi_{N-1})^T \pec
\LEQ{6}
\ee 
\be
\vec{\psi} = (\psi_1, \psi_2, \psi_3, \ldots , \psi_N)^T \pec
\LEQ{7}
\ee
and 
\be
D_{i,j} = \frac{1}{2} \int_{-1}^{+1} P_i(\mu) B_{j}(\mu) \; d\mu \pec \quad i=0,N-1, \; j=1,N.
\LEQ{8}
\ee
The matrix $\mD$ is called the discrete-to-moment matrix since it maps the discrete angular flux 
values to the Legendre moments of the angular flux.  In order to proceed, we must assume that $\mD$ 
is invertible.  Making this assumption, we generate the discrete S$_N$ scattering source via a similarity 
transformation from the Legendre moment basis to the discrete angular flux basis. In particular, the 
discrete scattering source values can be represented as follows:
\be
\vec{S} = \mS \vec{\psi}  = \mM \mX \mD \vec{\psi} \pec
\LEQ{9} 
\ee
where 
\be
\mM = \mD^{-1} \pec
\LEQ{10}
\ee
\be
\vec{S} = (S_1, S_2, S_3, \ldots, S_N)^T \pec
\LEQ{11}
\ee
and
\be
\mX = diag(\sigma_0, \sigma_1, \ldots , \sigma_{N-1}) \pep
\LEQ{12}
\ee
where $\sigma_k$ is the Legendre scattering cross section moment of degree $k$:
\be
\sigma_k = \frac{1}{2} \int_{-1}^{+1} P_k(\mu_0) \sigma_s(\mu_0) \; d\mu_0 \pep
\LEQ{13}
\ee
The matrix $\mM$ is called the moment-to-discrete matrix because it maps Legendre flux moments 
to discrete angular flux values:
\be
\vec{\psi} = \mM \vec{\phi} \pep
\LEQ{14}
\ee
The analytic Boltzmann scattering operator, $\mS_B$  can be represented as follows: 
\be
\mS_B \psi = \sum_{k=0}^{\infty} (2k+1) \sigma_k \phi_k P_k(\mu) \pec
\LEQ{15}
\ee
where $\phi_k$ is the $k$'th Legendre moment of the angular flux:
\be
\phi_k = \frac{1}{2} \int_{-1}^{+1}  \psi(\mu^{\prime}) P_k(\mu^{\prime}) \; d\mu^{\prime} \pep
\LEQ{16}
\ee
It is important to recognize that $\mX$ represents $\mS_B$ in the Legendre polynomial 
or P$_{N-1}$ basis, i.e., if you write the P$_n$ equations in matrix form, the scattering operator is 
given by $\mX$. Thus the S$_N$ scattering matrix given by \EQ{9} is equivalent to the P$_{N-1}$ scattering 
matrix via a similarity transformation. This property offers several advantages, which we will now describe. 

It is well-known that the eigenvalues of $\mS_B$ are the Legendre scattering cross section moments and the eigenfunctions are the Legendre polynomials: 
\bea
\mS_B P_{j}(\mu) & = & \sum_{k=0}^{\infty} (2k+1) \sigma_k  
\bracket{\frac{1}{2} \int_{-1}^{+1}  P_j(\mu^{\prime}) P_k(\mu^{\prime}) \; d\mu^{\prime} } \; P_k(\mu) \pec \nonumber \\
& = & \sigma_j P_j(\mu) \pep
\LEQ{16a}
\eea
Note from Eqs.~(\REQ{12}) and (\REQ{16a}) that $\mX$ preserves the first $N$ eigenvalues of $\mS_B$.  
Since $\mS$ is equivalent to $\mX$ via a similarity transformation, it follows that $\mS$ also 
preserves the first $N$ eigenvalues of $\mS_B$.
  
Another advantage of the equivalence to $\mX$ is that forward-peaked delta-function scattering is exactly treated.  
More specifically, when 
\be
\sigma_s(\mu_0) = 2 \delta(\mu_0-1) \pec
\LEQ{17}
\ee
one finds that 
\be
\sigma_k = 1  \pec \quad \mbox{for all $k$}.
\LEQ{18}
\ee
Substituting from \EQ{18} into \EQ{15}, we find that the exact scattering source corresponding to 
the interpolated representation for the angular flux is given by  
\be
\mS_B \tilde{\psi} =  \sum_{k=0}^{\infty} (2k+1) \phi_k P_k(\mu) = \psi(\mu) \pep
\LEQ{19}
\ee
Substituting from \EQ{18} into \EQ{9} via \EQ{12}, we find that the discrete scattering source is 
in pointwise agreement with \EQ{19}:
\be
\vec{S} = \mM \mathbf{I} \mD \vec{\psi} \ =  \mD^{-1} \mD \vec{\psi} = \vec{\psi} \pep
\LEQ{20}
\ee

In Method~1 we choose to interpolate the angular flux with global polynomials. We do so for several reasons, but 
the first is that the GQ matrix $\mM$ is easily generated without forming the interpolatory basis functions.  
In particular, the matrix $\mM$ is given by 
\be
M_{i,j} = (2j+1) P_j(\mu_i) \pec
\LEQ{21}
\ee
which is just the usual Legendre polynomial expansion of degree $N-1$ for the flux evaluated at the quadrature points:
\be
\phi_i = \sum_{j=1}^{N-1} (2j+1) \sigma_{k} \phi_k P_{k}(\mu_i) \pec
\LEQ{22}
\ee
The matrix $\mD$ can be obtained simply by inverting $\mM$. 

The equivalence of $\mS$ and $\mX$ coupled with polynomial interpolation of the discrete angular flux values results in a 
discrete scattering source that is actually exact in a certain pointwise sense.  
It is not the discrete scattering source corresponding to the exact angular flux solution, but rather it is the 
discrete scattering source obtained by applying the exact scattering operator to the assumed interpolated polynomial angular flux solution, and evaluating that 
source at the quadrature points.  To demonstrate this we first note that the scattering source for any arbitrary angular flux, $\psi$ can be exactly represented 
as follows:
\be
\mS_B \psi = \sum_{k=0}^{\infty} (2k+1) \sigma_{k} \phi_k P_{k}(\mu) \pep 
\LEQ{23}
\ee
However, if $\tilde{\psi}$ is a polynomial of degree $N-1$, then $\phi_k = 0$, for $k>N-1$, and \EQ{23} reduces to a polynomial of degree $N-1$:
\be
\mS_B \tilde{\psi} = \sum_{k=0}^{N-1} (2k+1) \sigma_{k} \phi_k P_{k}(\mu) \pep 
\LEQ{23a}
\ee
Thus the discrete scattering source for $\tilde{\psi}$ is given by 
\be
S_m = \sum_{k=0}^{N-1} (2k+1) \sigma_k \phi_k P_k(\mu_m) \pec \quad m=1,N,
\LEQ{24}
\ee 
which, given \EQ{23a}, is clearly pointwise exact.


If we set the discrete values of the angular flux to the Legendre polynomial of degree $j$, where $j \le N-1$, we get
\be
\psi_{m} = P_j(\mu_m) \pec \quad m=1,N.
\LEQ{24b}
\ee
Computing the moments of the angular flux, we get: 
\be
\mD \vec{\psi} = \vec{e}_j \pec 
\LEQ{24c}
\ee
where $\vec{e}_j$ is the cardinal vector having a $j$'th component of unity with all other components zero.  Next applying the cross section matrix, we 
obtain the legendre moment of the scattering source: 
\be
\mX \mD \vec{\psi} = \sigma_j \vec{e}_j \pep
\LEQ{24d}
\ee
Finally, we compute the discrete scattering source:
\be
\mM \mD \mD \vec{\psi} = \sigma_j \mM \vec{e}_j = \sigma_j P_j(\mu_m) \pec \quad m=1,N, 
\LEQ{24e}
\ee
It is clear from Eqs.~(\REQ{16a}) and (\REQ{24e}) that the first $N$ eigenfunctions as well as 
the first $N$ eigenvalues of the analytic scattering operator are preserved in a pointwise sense with Method~1.

In multiple dimensions, the advantages for global polynomial interpolation generalize to analogous advantages for 
spherical-harmonic interpolation.  The choice of harmonic moments to which to map the directions is complicated by the 
fact that the number of harmonics of a given degree does not match the number of directions, but prescriptions for the 
mapping have been defined for triangular and product sets in R-Z and Cartesian geometries \cite{Morel89,Richard,Trahan}.


\section{METHOD~2}

In a recent paper, it was shown that in 1-D slab-geometry with isotropic scattering, the standard S$_N$ 
equations are equivalent to P$_{N-1}$ equations with a quadrature-dependent closure if the discrete-to-moment matrix 
defined by \EQ{22} is invertible \cite{Morel12}. This is clearly a highly desirable property, but anisotropic scattering 
was not considered in Reference~\citenum{Morel12}. We show in Section~(\ref{sec:momeqns}) that this property also applies with 
anisotropic scattering if one uses a certain variation of the GQ method to represent the scattering source.  In particular, 
one must define $\mD$ in accordance with the standard application of an S$_N$ quadrature formula:
\be
D_{i,j} = P_i(\mu_j) w_j \pec
\LEQ{25a}
\ee
or equivalently,
\be 
\phi_i = \sum_{m=1}^{N} \psi_m P_{i}(\mu_m) w_m \pec \quad i=0,N-1.
\LEQ{25b}
\ee
Then $\mM$ is obtained simply by inverting $\mD$. This approach, which we refer to as Method~2 is similar to Method~1 
in that it ensures that the first $N$ eigenvalues of the scattering source are exactly preserved and that forward-peaked delta-function 
scattering is treated exactly.  However, the scattering source is generally not pointwise exact in any sense, and the first $N$ eigenvectors 
of the scattering operator are generally not pointwise preserved.  Thus both Method 1 and Method 2 offer certain advantages, but it is not 
clear that either will be superior in general.  Warsa and Prinja \cite{warsa} recently proposed a moment-preserving discretization for the 1-D 
Fokker-Planck scattering operator that is actually equivalent to Method 2  using the Fokker-Planck cross section moments defined 
by Morel \cite{Morel-FP}, although it is not obvious from their derivation.

\subsection{Angular Moment Equations}
\label{sec:momeqns}
Here we demonstrate that Method~2 yields Legendre moment equations through degree $N-1$ with a quadrature-dependent closure.  We begin with the 
S$_N$ equations assuming use of a Method~2 Galerkin quadrature:
\be
\mu_m \dxdy{\psi}{x} + \sigma_t \psi = \sum_{k=0}^{N-1} M_{m,k} (\sigma_k \phi_k + q_k)  \pec \quad m=1,N,
\LEQ{25}
\ee
where $M_{m,k}$ is the column $m$ and row $k$ element of $\mM=\mD^{-1}$, the $k$'th Legendre moment of the homogeneous 
source is denoted by $q_k$, and 
\be
\phi_k = \sum_{m=1}^{N} \psi_m P_k(\mu_m) w_m \pec \quad k=0,N.
\LEQ{26}
\ee
Note that \EQ{26} is consistent with the Method~2 definition for $\mD$ for $k=0,N-1$, and defines $\phi_N$ as well.
Next we multiply \EQ{25} by $P_k(\mu_m) w_m$ where $k=0,N-1$, and sum over all directions. Recognizing that 
\be
\mu P_k(\mu) = \frac{k+1}{2k+1} P_{k+1}(\mu) + \frac{k}{2k+1} P_{k-1}(\mu) \pec
\LEQ{27}
\ee
and using the fact that $P_k(\mu_m) w_m$ is the column $k$ and row $m$ element of $\mD$, 
we obtain the following system of moment equations:
\begin{gather}
\LEQ{28}
\dddx{\phi_1} + \sigma_t \phi_0 = \sigma_0 \phi_0 + q_0 \varrho \pec \\
\LEQ{29}
\frac{k+1}{2k+1} \dddx{\phi_{k+1}} + \frac{k}{2k+1} \dddx{\phi_{k-1}} +  \sigma_t \phi_k  = \sigma_k \phi_k + q_k \pec \quad k=1,N-2, \\
\LEQ{30}
\frac{N}{2N-1} \dddx{\phi_{N}} + \frac{N-1}{2N-1} \dddx{\phi_{N-2}} + \sigma_t \phi_{N-1} = \sigma_0 \phi_{N-1} + q_{N-1} \pep
\end{gather}
These moment equations are in fact the exact Legendre moment equations.  The system appears to be open because there are 
$N+1$ unknowns and $N$ equations. However, since $\phi_{N}$ is given by \EQ{26} and there is an mapping between the first $N$ Legendre flux moments and the angular fluxes via $\mM=\mD^{-1}$, it follows that $\phi_N$ is a function of these moments.  In particular, using $\mM$ to express the angular fluxes in \EQ{26} in terms of the first $N$ Legendre flux moments, we obtain 
\bea
\phi_N &=& \sum_{m=1}^{N} \psi_m P_N(\mu_m) w_m  \pec \nonumber \\
 & = & \sum_{m=1}^{N} \bracket{ \sum_{k=0}^{N-1} M_{m,k} \phi_k}  \pec \nonumber \\
 & = & \sum_{k=0}^{N-1}\bracket{ \sum_{m=1}^{N} M_{m,k} P_N(\mu_m) w_m} \phi_k \pep
\LEQ{31}
\eea
Equation~(\REQ{31}) represents the closure for a set of exact Legendre moment equations of degree $N-1$ that are completely equivalent to the 
S$_N$ equations with Galerkin quadrature as defined by Method~2.  It has not been demonstrated that this property holds in any geometry other 
than 1-D slab geometry, but we suspect that it does in all Cartesian geometries.  This property does not apply in general even in 1-D slab geometry 
with Method~1. 


\section{Standard S$_N$ Scattering Source}

While the GQ method may seem quite different from the standard S$_N$ method for representing the scattering 
source, the generation of the source requires the same algebraic steps.  For instance, if we assume a scattering 
cross section expansion order of degree $N-1$, the standard S$_N$ scattering source can be represented by \EQ{9} with 
$\mM$ defined by 
\be
M_{i,j} = (2j+1) P_j(\mu_i) \pec
\LEQ{32a}
\ee
and $\mD$ defined by 
\be
D_{i,j} = P_i(\mu_j) w_j \pec
\LEQ{32b}
\ee
where $w_j$ is the quadrature weight for direction $j$, and with $\mX$ defined by \EQ{12}. 
The most obvious problem with the S$_N$ method is that $\mM$ and $\mD$ are in general not inverses of each other.  
The only exception is the case of Gauss quadrature.  In this case, the standard S$_N$ method, the GQ Method~1, and the GQ Method~2 
are all {\it equivalent}. 

We note that if the scattering is weakly anisotropic, i.e., if the cross section expansion converges with 
$K$ moments where $K$ is less than the number of quadrature directions, one need only store $K$ columns of the moment-to-discrete matrix and 
$K$ rows of the discrete-to-moment matrix to compute the scattering source.  Thus the GQ method can be used with 
weakly anisotropic scattering at the same computational cost as the standard S$_N$ method. 

\section{COMPUTATIONAL RESULTS}
The standard S$_N$ scattering source treatment in 1-D slab-geometry with Gauss quadrature is equivalent to {\em both} the Method~1 and Method~2 
Galerkin treatments.  There is no quadrature set in multidimensions that yields an equivalence between the standard S$_N$ scattering source 
treatment and any Galerkin treatment.  Thus we choose to compare Methods 1 and 2 in 2-D Cartesian geometry rather than 1-D slab geometry. 
To provide a stringent test of the quadratures, we assumed anisotropic scattering in the test problems that approximates Fokker-Planck scattering.  Such scattering is described in Sec.~(\ref{sec:intro}). To obtain a standard for comparison we performed Monte Carlo calculations. 


\subsection{Problem Definition}
There is one test problem. The directional coordinate system for the test problem 
is oriented such that $\xi=\cos(\theta)$ is the $z$-axis cosine, 
$\mu=\sin(\theta)\cos(\phi)$ is the $x$-axis cosine, and $\eta=\sin(\theta)\sin(\phi)$ is the $y$-axis cosine.  
The test  problem is defined in 2-D $x$-$y$ geometry.  The spatial domain 
is a $10$ cm $\times$ $10$ cm square with $x\in [0, 10]$ and $y\in [0, 10]$. There are four faces, $x^{-}$, $x^{+}$, 
$y^{-}$ and $y^{+}$.  On the $x^{-}$ face the value of $x$ is everywhere equal to zero, and on the $x^{+}$ face the 
value of $x$ is everywhere equal to 10.  The definitions for $y^{\mp}$ are analogous.  
The boundary conditions are vacuum on both $y$-faces and the $x^{+}$ face.  
There is an angular flux uniformly incident on the $x^{-}$ face that is constant for $\xi\in[0,1]$ and 
$\phi \in [0,\pi/2]$, and otherwise zero.  The flux is normalized to yield a unit incident half-range current 
$(p/s)$.  The problem geometry is illustrated in \FI{1}.  A 65 $\times$ 65 uniform rectangular spatial mesh was used in the 
calculations with each rectangle cut into four triangles.  A linear-discontinuous approximation was used on each triangle.
 
The quantities of interest are the leakages $(p/s)$ out of each of the four faces.  To aid us in understanding the results we 
obtained for these leakages, we also computed the angular fluxes and flux moments moments at the center of each face using the interior 
face fluxes as illustrated in \FI{2}.  Due to upwinding, only the interior outgoing fluxes on each face are true face fluxes, but the 
interior incoming fluxes nonetheless represent a second-order accurate approximation to the true incoming face fluxes.  We did not 
calculate these angular fluxes and flux moments by Monte Carlo.  For reasons that will later be clear, it is not necessary for our 
purposes to know the accuracy of these moments.
\begin{figure}[htb]
\begin{center}
%phics[scale=0.75]{cgq1.pdf}
\caption{Problem geometry with incident flux. The arrows are intended to indicate the quarter-range isotropic nature of the incident flux, 
which is constant on the $x^{-}$ face. Each face is 10 $cm$ in length.}
\LFI{1}
\end{center}
\end{figure}
\begin{figure}[htb]
\begin{center}
%phics[scale=0.75]{face_flux_points.jpg}
\caption{Illustration of face flux calculation.  The two interior corner fluxes about each face center are averaged to obtain a face-centered value.}
\LFI{2}
\end{center}
\end{figure}

Fokker-Planck scattering can be represented by Legendre scattering cross section moments because the spherical-harmonics are eigenfunctions 
of both the Boltzmann and Fokker-Planck scattering operators \cite{Morel-FP}. In particular, for a cross section expansion of degree $K$, 
\be
\sigma_k = \alpha \bracket{K(K+1) - k(k+1)} \pec \quad k=0,K. 
\LEQ{34}
\ee
where $\alpha$ $(cm^{-1})$ is the transport-corrected scattering cross section. However, we chose not to use these coefficients 
because  Monte Carlo codes cannot use the Legendre coefficients defined in \EQ{34} even if a discrete scattering 
angle formulation based upon Legendre cross section expansions \cite{BFP} is used.  This is so because the expansion coefficients 
defined in \EQ{34} approach the Fokker-Planck limit as $N \rightarrow \infty$ from a non-physical region in moment space.
Furthermore, we know of no Monte Carlo algorithm to exactly simulate Fokker-Planck scattering.  Thus we assume assume a forward-peaked 
scattering cross section that approximates Fokker-Planck scattering as described in Reference \citenum{BFP}. In particular, the following 
cross section is assumed: 
\be
\sigma_s(\mu_0) = 500 \; \delta(\mu_0 - 0.999) \pep
\LEQ{35}
\ee
Note that the transport-corrected scattering cross section corresponding to \EQ{35} is equal to 0.25 $cm^{-1}$:
\be
\sigma_{s,tr}=\frac{1}{2} \int_{-1}^{+1} \sigma_s(\mu_0)\fn{1-\mu_0} \, d\mu_0 \pep
\LEQ{34a}
\ee
We assume an absorption cross section of 0.1 $cm^{-1}$ in all calculations.


\subsection{S$_N$ Calculations} 
S$_N$ calculations are performed for the test problem using Method 1 and Method 2 Galerkin 
quadrature in conjunction with the discrete directions for Gauss-Chebychev triangular quadrature.  The problem 
is performed for several different orders of quadrature to gauge convergence rate in addition to comparing the two methods.
The Gauss-Chebychev directions are given by the 1-D Gauss directions in the $\xi$-cosine and the 1-D Chebychev (equally-spaced) 
directions in the azimuthal angle. The spherical-harmonics to which the directions of an S$_N$ set are mapped are defined as 
follows:
\begin{subequations}
\bea
\LEQ{35a}
Y^{m}_{k} &=& \sqrt{C_{k}^{m}} P_{k}^{m}(\xi) cos(m\omega) \pec \quad \mbox{for $ k \ge 0$ and $ k \ge m \ge 0$}, \\
&=& \sqrt{C_{k}^{m}} P_{k}^{m}(\xi) sin(|m|\omega) \pec \quad \mbox{for $k \ge 0$ and $0 >  m  \ge -k$},
\LEQ{35b}
\eea
\end{subequations}
where $P_{k}^{m}(x)$ is the associated Legendre function, and 
\be
C_{k}^{m} = (2 - \delta_{m,0}) \frac{(k - |m|!)}{(k + |m|!)} \pec
\LEQ{36}
\ee
The specific set of harmonics mapped to triangular S$_N$ quadrature in 2-D Cartesian geometry are as follows.
The harmonic $Y^{m}_{k}$ is a member of the set if and only if:
\bi
\item $k+|m|$ is even, and 
\item $k < N$, and $k \ge  m \ge -k$, or 
\item $k=N$, and $0 > m \ge -k$.
\ei
We suspect that this is the only acceptable set of harmonics with $k \le N$, but we cannot prove it. An unacceptable 
set of harmonics leads to a singular mapping between $\vec{\psi}$ and $\vec{\phi}$. Discovering the "rule" for choosing 
the harmonics is basically a trial and error process guided by geometric and quadrature symmetries. We are fairly 
certain that there are other sets containing harmonics with $k > N$ that are acceptable, but we would expect 
them to yield mappings that are more ill-conditioned than those associated with our choice of harmonics.  Ideally, 
one would like to obtain mappings that are as well-conditioned as possible.   
  
It is important to note that in applying Method~2, we did not use the standard Gauss-Chebychev weights. Rather, we used 
the companion quadrature weights associated with Method~1. The companion weights correspond to the first row of the 
discrete-to-moment matrix, which is used to generate the first flux moment, i.e., the scalar flux. The correspondence 
between these matrix elements and quadrature weights is clear from \EQ{5};
\be
\phi = \sum_{m=1}^{N} D_{0,m} \psi_m \pec
\LEQ{36a}
\ee
where $\phi$ is the scalar flux.  Although \EQ{36a} is taken from a 1-D expression, it applies in general where $N$ is 
the total number of directions. The first angular moment will always correspond to the scalar flux since the interpolatory 
space must always be able to represent an isotropic angular flux. One need not generate the discrete-to-moment matrix to obtain 
the companion weights.  Rather, given the Gauss-Chebychev directions, 
one can obtain these weights simply by requiring that the quadrature formula exactly integrate the spherical harmonics 
used to interpolate the angular fluxes in Method~1. This results in a linear system of equations for the weights. 

We use the companion weights in Method~2  because use of the standard Gauss-Chebychev weights results in an anisotropic scattering 
source with isotropic scattering.  This is clearly unacceptable. In general, one should always apply Method~2 with a quadrature formula 
that exactly integrates the harmonics used to interpolate the angular fluxes in Method~1.  In some instances, standard quadratures can do 
this. For instance, standard product (square) Gauss-Chebychev quadrature do integrate the interpolatory harmonics.

We also attempted to perform S$_n$ calculations with the standard quadrature treatment for comparison with our Galerkin
quadrature calculations. The standard Gauss-Chebychev directions and weights were used in conjunction 
with a scattering cross section expansion of degree $N-1$. All of the harmonics of degree less than or equal to $N-1$ can be 
exactly integrated with the standard triangular Gauss-Chebychev quadrature, so particle conservation was maintained (this is not the case 
for expansion degrees greater than $N-1$).  However, we found that the source iteration matrices that had eigenvalues with magnitudes greater 
than one, i.e., source iteration was unstable. Thus we could not provide computational results for the standard S$_n$ quadrature treatment.       

\section{Monte Carlo Calculation}
To obtain benchmark solutions for comparison with the discrete-ordinates solutions, we performed Monte Carlo calculations for each of the 
two problems. Each calculation was performed with $10^9$ total histories in 100 batches.

\subsection{Comparison of Methods}
The results of our tests calculations are given in \TA{1}.  
As expected from the shape of the incident flux distribution, the leakage through the $y^-$ face is the most difficult to compute.  
Thus we focus on this leakage.  The  GQ Method 1 formulation is significantly more accurate than the 
GQ Method 2 formulation at the S$_4 $ level, but the two approaches yield very similar results for higher order quadratures and the differences 
in the results decrease with increasing quadrature order. The question arises as to why the GQ methods yield such similar results when 
their respective $\mD$ and $\mM$ matrices differ significantly for the higher-order moments.  One possible explanation is that the 
higher order moments are relatively small, rendering higher-order differences in the $\mD$ and $\mM$ matrices moot.  We computed the angular 
flux moments at the face centers to investigate this possiblity.  The S$_8$ flux moments on the 
y$^{-}$ face are given for both the GQ Method 1 and the GQ Method 2 in \TA{2}.  It can be ween from \TA{2} that the higher-order moments are 
indeed relatively small for both methods.  This result is not surprising given the nature of the attenuation coefficients associated with 
highly forward peaked scattering.  For instance, it can be determined from \EQ{34} that for Fokker-Planck scattering  
the $k$'th total attenuation coefficient is given by $\sigma_0-\sigma_k = \alpha k(k+1)$.  This coefficient rapidly increases 
with increasing $k$.  Thus the higher-order flux moments are strongly attenuated relative to the lower-order moments.  This is in contrast 
to isotropic scattering for which all moments other than the scalar flux have the same attenuation coefficient.  The two quadrature sets yield 
identical solutions with isotropic scattering and with no scattering at all.  Thus making the scattering more isotropic or making the 
problem more optically thin does not change the similarity of results from the two methods.  We have been unable to construct a problem for 
which the GQ1 and GQ2 sets yield significantly different results for any other than the very lowest quadrature orders. 


\begin{table}[!htb]
\centering
\caption{\bf Comparison of leakages $(p/s)$ for GQ Method 1 (GQ1), GQ Method 2 (GQ2), and Monte Carlo (MC).}
\LTA{1}
\vspace{14pt}
\small
\begin{tabular}{crcccc} 
\toprule[1pt]
                          & & \multicolumn{4}{c}{Face} \\ \cline{3-6}
\multicolumn{2}{c}{Method}  &  $x^-$  & $x^+$  & $y^-$  & $y^+$  \\ \hline
\multicolumn{2}{c}{MC}      & $0.199278 \pm 1.4 \cdot 10^{-5}$  
                            & $0.019233 \pm 4.6 \cdot 10^{-6}$  
                            & $0.072106 \pm 8.7 \cdot 10^{-6}$  
                            & $0.190231 \pm 1.4 \cdot 10^{-5}$ \\  \hline
\multirow{3}{*}{S$_{4}$}    
& GQ1 & 2.220842e-01 & 1.821048e-02 & 6.744504e-02 & 1.930308e-01 \\
& GQ2 & 2.220842e-01 & 1.821048e-02 & 6.532314e-02 & 1.951527e-01 \\ 
 \hline
\multirow{3}{*}{S$_{8}$}    
& GQ1 & 2.091496e-01 & 1.894772e-02 & 7.002274e-02 & 1.899175e-01 \\
& GQ2 & 2.091496e-01 & 1.894771e-02 & 6.970301e-02 & 1.902372e-01 \\
 \hline
\multirow{3}{*}{S$_{16}$}  
& GQ1 & 2.024318e-01 & 1.914877e-02 & 7.141571e-02 & 1.900609e-01 \\
& GQ2 & 2.024318e-01 & 1.914877e-02 & 7.138919e-02 & 1.900875e-01 \\
 \hline
\multirow{3}{*}{S$_{32}$}   
& GQ1 & 2.000532e-01 & 1.920919e-02 & 7.192883e-02 & 1.902319e-01 \\
& GQ2 & 2.000532e-01 & 1.920917e-02 & 7.192763e-02 & 1.902331e-01 \\
\bottomrule[1pt]
\end{tabular}
\normalsize
\end{table}


\begin{table}[!htb]
\centering
\caption{\bf Comparison of the S$_8$ GQ Method 1 and the GQ Method flux moments at the center of the y$^{-}$ face.}
\LTA{2}
\vspace{14pt}
\small

\normalsize
\end{table}



\section{CONCLUSIONS} 

Our results indicate that the two types of triangular Gauss-Chebychev Galerkin quadrature sets are quite comparable for 
the highly forward-peaked scattering problem considered.  Indeed, we were unable to construct any problem for which the two 
methods yielded significantly different results.  In contrast, the standard triangular Gauss-Chebychev sets are not suitable 
for the problem considered due to instability of the source iteration process.   We intend to investigate 
the application of the two Galerkin quadrature methods to other types of quadrature sets in the future.   

  

\section*{ACKNOWLEDGEMENTS}

This information has been authored by employees of the Los Alamos National Security, LLC (LANS) operator of Los Alamos 
National Laboratory under contract No DE-AC52-06NA25396 with the U.S. Department of Energy.

Sandia National Laboratories is a multi-program laboratory managed and operated by Sandia Corporation, a wholly owned 
subsidiary of Lockheed Martin Corporation, for the U.S. Department of Energy's National Nuclear Security Administration 
under contract DE-AC04-94AL85000.
 

%\Section*{REFERENCES}
\setlength{\baselineskip}{12pt}
\begin{thebibliography}{300}

\bibitem{Morel89} J. E. Morel, ``A Hybrid Collocation-Galerkin-$S_n$  Method for Solving the
Boltzmann Transport Equation,'' {\em Nuclear Science and Engineering}, {\bf 101}, 72-87 (1989).

\bibitem{Richard} Richard Sanchez, Jean Ragusa, ``On the Construction of Galerkin Angular Quadratures,''
{\em Nuclear Science and Engineering}, {\bf 169}, 133-154 (2011).

\bibitem{Trahan} Travis Trahan, Jean Ragusa, and Jim Morel, ``Galerkin Quadratures for the S$_n$ 
Method in 2D Cartesian Geometries and Application to Forward-Peaked Scattering Particle Transport Problems,'' 
{\em International Conference on Mathematics, Computational Methods \& Reactor Physics (M\&C 2009)}, 
Saratoga Springs, New York, May 3-7, 2009, on CD-ROM, American Nuclear Society, LaGrange Park, IL (2009).

\bibitem{warsa} J. S. Warsa and A. K. Prinja,``A Moment-Preserving S$_N$ Discretization for the One-dimensional Fokker-Planck 
Equation,'' {\em Transactions of the American Nuclear Society},  {\bf 106}, 362-365 (2012).  

\bibitem{Morel12} Jim E. Morel, Jean C. Ragusa, Marvin L. Adams, Guido Kanschat, ``Asymptotic P$_N$-Equivalent S$_{N+1}$ Equations,'' 
{\em Transport Theory and Statistical Physics}, {\bf 42:1}, 3-20 (2013).

\bibitem{FP} C. Borgers and E. Larsen, ``On the Accuracy of the Fokker-Planck and Fermi Pencil Beam Equations 
for Charged-Particle Transport,'' {\em Medical Physics}, {\bf 23}, 1749--1759 (1996).

\bibitem{Morel-FP}  J. E. Morel, ``Fokker-Planck Calculations Using Standard Discrete
Ordinates Codes,'' {\em Nuclear Science and Engineering}, {\bf 79}, 340-356 (1981).

\bibitem{BFP} J. E. Morel, Leonard J. Lorence, Jr., Ronald P. Kensek, and John A. Halbleib, 
``A Hybrid Multigroup/Continuous-Energy Monte Carlo Method for Solving the 
Boltzmann-Fokker-Planck Equation.'' {\em Nuclear Science and Engineering}, {\bf 124}, 369-389 
(1996).
\end{thebibliography}



\end{document}


